<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>祝你生日快乐！！！</title>
<!--    <title>祝妹子生日快乐！</title>-->
    <link rel="stylesheet" th:href="@{css/reset.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{css/style.css}" media="screen" type="text/css"/>
    <link rel="stylesheet" th:href="@{css/sakura_normalize.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{css/music_style.css}" type="text/css"/>
    <!--    <link rel="stylesheet" th:href="@{css/sakura_style.css}" type="text/css" />-->
    <script th:src="@{js/sakura_prefixfree.min.js}"></script>
    <script th:src="@{js/jquery-3.8.min.js}"></script>
    <script th:src="@{js/jquery.marquee.min.js}"></script>
    <script th:src="@{js/music_script.js}"></script>
    <script>
        (function (q) {
            /* 目前只支持网易云音乐的这几种类型
             * type:
             *     list - 歌单，默认
             *     dj   - 电台
             */
            q.type = 'list'; // 类型
            q.id = 3136952023; //类型所对应的id
            q.isAuto = true; //是否自动播放，默认false
            q.isRandom = true; //是否随机播放，默认true
            q.isRotate = true; //封面是否旋转，默认true
        })(QPlayer);
    </script>
</head>

<body id="videobox">
<!-- 音乐播放器 -->
<div id="QPlayer">
    <div class="body">
        <div style="margin-left: 15px">
            <input type="text" value="生日快乐" id="mmmna" /> <button id="serchMU">搜索</button>
        </div>
        <div class="player">
					<span class="cover">
						<img id="mussIMg" src="https://p4.music.126.net/7VJn16zrictuj5kdfW1qHA==/3264450024433083.jpg?param=106x106">
					</span>
            <div class="ctrl">
                <div class="title">
                    <strong>name</strong><span> - </span><span class="artist">artist</span>
                </div>
                <div class="progress">
                    <div class="already" style="width:0%;">
                        <div class="btn"></div>
                    </div>
                </div>
                <div class="contr">
                    <div class="timer left">00:00</div>
                    <div class="center">
                        <div class="last icon"></div>
                        <div class="play icon"></div>
                        <div class="next icon"></div>
                    </div>
                    <div class="right">
                        <div class="list-btn icon"></div>
                        <div class="lyric-btn icon"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="pop-btn">
            <div class="icon" th:style="'background-image:url(/img/icon.png)'"></div>
        </div>
    </div>
    <div class="more">
        <ol class="list"></ol>
        <div class="lyric"><ol></ol></div>
    </div>
    <audio></audio>
</div>
<!-- 背景烟花 -->
<!--<canvas id="canvas"></canvas>-->
<!-- 背景樱花 -->
<canvas id="sakura"></canvas>
<!-- 蜡烛 -->
<div class="velas">
    <div class="fuego"></div>
    <div class="fuego"></div>
    <div class="fuego"></div>
    <div class="fuego"></div>
    <div class="fuego"></div>
</div>
<!-- 蛋糕动画 -->
<!-- y烟花js -->
<!--<script th:src="@{js/yanhua.js}" ></script>-->
<div class="text">

    <div>
        <div id="divcake">
            <svg id="cake" version="1.1" x="0px" y="0px" width="200px" height="500px" viewBox="0 0 200 500"
                 enable-background="new 0 0 200 500" xml:space="preserve">
    <path fill="#a88679" d="M173.667-13.94c-49.298,0-102.782,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c44.697,0,96.586,0,147.334,0C177.667-29.942,177.668-13.94,173.667-13.94z">
        <animate id="bizcocho_3" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1" begin="relleno_2.end"
                 dur="0.1s" fill="freeze" values="
                          M173.667-13.94c-49.298,0-102.782,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c44.697,0,96.586,0,147.334,0C177.667-29.942,177.668-13.94,173.667-13.94z
                          ;
                          M173.667,411.567c-47.995,12.408-102.955,12.561-147.334,0
		c-3.848-1.089-0.189-16.089,3.661-15.002c44.836,12.66,90.519,12.753,139.427,0.07
		C173.293,395.631,177.541,410.566,173.667,411.567z
                          ;
                          M173.667,427.569c-49.795,0-101.101,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c46.385,0,97.539,0,147.334,0C177.668,411.567,177.667,427.569,173.667,427.569z
                          "/>
    </path>
                <path fill="#8b6a60" d="M100-178.521c1.858,0,3.364,1.506,3.364,3.363c0,0,0,33.17,0,44.227
		c0,19.144,0,57.431,0,76.574c0,10.152,0,40.607,0,40.607c0,1.858-1.506,3.364-3.364,3.364l0,0c-1.858,0-3.364-1.506-3.364-3.364c0,0,0-30.455,0-40.607c0-19.144,0-57.432,0-76.575c0-11.057,0-44.226,0-44.226C96.636-177.015,98.142-178.521,100-178.521
		L100-178.521z">
        <animate id="relleno_2" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1; 0 0 0.58 1"
                 begin="bizcocho_2.end" dur="0.1s" fill="freeze" values="
                          M100-178.521c1.858,0,3.364,1.506,3.364,3.363c0,0,0,33.17,0,44.227
		c0,19.144,0,57.431,0,76.574c0,10.152,0,40.607,0,40.607c0,1.858-1.506,3.364-3.364,3.364l0,0c-1.858,0-3.364-1.506-3.364-3.364c0,0,0-30.455,0-40.607c0-19.144,0-57.432,0-76.575c0-11.057,0-44.226,0-44.226C96.636-177.015,98.142-178.521,100-178.521
		L100-178.521z
                          ;
                          M100,267.257c1.858,0,3.364,1.506,3.364,3.363c0,0,0,33.17,0,44.227
		c0,19.143,0,57.43,0,76.574c0,10.151,0,40.606,0,40.606c0,1.858-1.506,3.364-3.364,3.364l0,0c-1.858,0-3.364-1.506-3.364-3.364
		c0,0,0-30.455,0-40.606c0-19.145,0-57.432,0-76.576c0-11.057,0-44.225,0-44.225C96.636,268.763,98.142,267.257,100,267.257
		L100,267.257z
                          ;
                          M93.928,405.433c-0.655,6.444-0.102,9.067,2.957,11.798c0,0,8.083,5.571,16.828,3.503
		c18.629-4.406,43.813,6.194,50.792,7.791c14.75,3.375,9.162,6.867,9.162,6.867c-2.412,2.258-58.328,0-73.667,0l0,0
		c-1.858,0-69.995,2.133-73.667,0c0,0-3.337-2.439,6.172-5.992c11.375-4.25,52.875,8.822,47.139-9.442
		c-6.333-20.167,5.226-21.514,5.226-21.514c3.435-0.915,12.78-6.663,10.923-0.546L93.928,405.433z
                          ;
                          M102.242,427.569c5.348,0,14.079,0,17.462,0c0,0,17.026,0,27.504,0
		c19.143,0,20.39-3.797,26.459,0c3,1.877,0,7.823,0,7.823c-2.412,2.258-58.328,0-73.667,0l0,0c-1.858,0-67.187,0-73.667,0
		c0,0-4.125-4.983,0-7.823c5.201-3.58,16.085,0,23.725,0c8.841,0,20.762,0,20.762,0c3.686,0,8.597,0,19.511,0H102.242z
                          "/>
    </path>
                <path fill="#a88679" d="M173.667-15.929c-46.512,0-105.486,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c43.566,0,97.96,0,147.334,0C177.667-31.931,177.666-15.929,173.667-15.929z">
        <animate id="bizcocho_2" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1; 0.25 0 0.58 1"
                 begin="relleno_1.end" dur="0.1s" fill="freeze" values="
                          M173.667-15.929c-46.512,0-105.486,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c43.566,0,97.96,0,147.334,0C177.667-31.931,177.666-15.929,173.667-15.929z
                          ;
                          M173.434,445.393c-47.269,8.001-105.245,8.001-147.334,0c-3.929-0.747-0.692-16.543,3.243-15.824
		c43.828,8.001,92.165,8.001,140.739,0C174.029,428.918,177.377,444.726,173.434,445.393z
                          ;
                          M173.667,449.514c-47.576-5.454-102.799-5.744-147.333,0c-3.966,0.512-3.938-15.297,0-16.002
		c43.683-7.823,97.646-8.026,147.333,0C177.616,434.15,177.642,449.969,173.667,449.514z
                          ;
                          M173.667,451.394c-49.298,0-102.782,0-147.334,0c-3.999,0-4-16.002,0-16.002
		c44.697,0,96.586,0,147.334,0C177.667,435.392,177.668,451.394,173.667,451.394z
                          "/>
    </path>
                <path fill="#8b6a60" d="M101.368-73.685c0,12.164,0,15.18,0,28.519c0,22.702,0-13.661,0,8.304c0,14.48,0,18.233,0,30.512
		c0,1.753-2.958,1.847-2.958,0c0-12.68,0-16.277,0-30.401c0-21.983,0,11.66,0-8.305c0-13.027,0-15.992,0-28.628
		C98.411-75.883,101.368-75.592,101.368-73.685z">
        <animate id="relleno_1" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1; 0 0 0.6 1"
                 begin="bizcocho_1.end" dur="0.1s" fill="freeze" values="
                          M101.368-73.685c0,12.164,0,15.18,0,28.519c0,22.702,0-13.661,0,8.304c0,14.48,0,18.233,0,30.512
		c0,1.753-2.958,1.847-2.958,0c0-12.68,0-16.277,0-30.401c0-21.983,0,11.66,0-8.305c0-13.027,0-15.992,0-28.628
		C98.411-75.883,101.368-75.592,101.368-73.685z
                          ;
                          M101.368,350.885c0,12.164,0,65.18,0,78.518c0,22.703,0-33.66,0-11.695c0,14.48,0,28.232,0,40.512
		c0,1.753-2.958,1.847-2.958,0c0-12.68,0-26.277,0-40.402c0-21.982,0,31.66,0,11.695c0-13.027,0-65.992,0-78.627
		C98.411,348.686,101.368,348.977,101.368,350.885z
                          ;
                          M128.38,447.567c37.626,6.312,39.303,13.658,26.833,12.833c-22.653-1.499-13.636-0.831-23.302-0.831
		c-14.48,0-17.884,0-30.163,0c-2.087,0-2.068,0-3.915,0c-13.333,0-8.963,0-23.088,0c-11.668,0-14.062,5.995-27.532,1.164
		c-12.629-4.529,38.667-3.167,46.833-17.333C100.077,432.94,105.546,443.736,128.38,447.567z
                          ;
                          M173.667,451.394c2.875,0,2.997,9.257,0,9.131c-22.662-0.956-32.09-0.956-41.756-0.956
		c-14.48,0-17.884,0-30.163,0c-2.087,0-2.068,0-3.915,0c-13.333,0-8.963,0-23.088,0c-11.668,0-34.99-0.294-48.412,1.831
		c-4.109,0.65-3.01-10.006,0-10.006C37.129,451.394,149.379,451.394,173.667,451.394z
                          "/>
    </path>
                <path fill="#a88679" d="M173.667,21.571c-33.174,0-111.467,0-147.334,0c-4,0-4-16.002,0-16.002c39.836,0,105.982,0,147.334,0
		C177.668,5.569,177.667,21.571,173.667,21.571z">
        <animate id="bizcocho_1" attributeName="d" calcMode="spline"
                 keySplines="0 0 1 1; 0 0 1 1; 0 0 1 1; 0.25 0 1 1; 0 0 1 1; 0.25 0 0.6 1" begin="2s" dur="0.1s"
                 fill="freeze" values="
                          M173.667,21.571c-33.174,0-111.467,0-147.334,0c-4,0-4-16.002,0-16.002c39.836,0,105.982,0,147.334,0
		C177.668,5.569,177.667,21.571,173.667,21.571z
                          ;
                          M173.667,459.569c-33.197,16.002-110.782,16.002-147.334,0c-3.664-1.604,1.614-15.617,5.337-14.153
		c40.702,16.002,94.289,16.104,136.505,0.103C171.917,444.1,177.271,457.832,173.667,459.569z
                          ;
                          M171.817,475.571c-39.361-3.001-105.438-2.571-143.556,0c-3.991,0.27-7.377-14.736-3.387-15.014
		c41.553-2.888,104.421-3.121,150.51-0.233C179.378,460.574,175.806,475.875,171.817,475.571z
                          ;
                          M171.817,459.564c-38.8-12.188-104.504-13.762-143.556,0c-3.772,1.329-7.961-12.604-4.178-13.905
		c40.864-14.064,105.114-15.52,151.918-0.973C179.822,445.874,175.634,460.762,171.817,459.564z
                          ;
                          M173.667,475.571c-46.376-5.005-105.924-4.003-147.334,0c-3.981,0.385-3.479-15.421,0.479-16.002
		c43.087-6.327,97.705-7.083,146.855,0.438C177.621,460.613,177.644,476,173.667,475.571z
                          ;
                          M173.667,474.117c-46.376,1.866-105.638,2.01-147.334,0c-3.995-0.192-3.52-16.144,0.479-16.002
		c43.794,1.55,96.341,1.541,145.723,0C176.532,457.99,177.663,473.956,173.667,474.117z
                          ;
                          M173.667,475.571c-46.512,0-105.486,0-147.334,0c-3.999,0-4-16.002,0-16.002c43.566,0,97.96,0,147.334,0
		C177.667,459.569,177.666,475.571,173.667,475.571z
                          "/>
    </path>
                <path fill="#fefae9" d="M104.812,113.216c0,3.119-2.164,5.67-4.812,5.67c-2.646,0-4.812-2.551-4.812-5.67c0-5.594,0-16.782,0-22.375
	c0-5.143,0-15.427,0-20.568c0-7.333,0-21.998,0-29.33c0-5.523,0-16.569,0-22.092c0-3.295,0-9.885,0-13.181
	C95.188,2.551,97.353,0,100,0c2.648,0,4.812,2.551,4.812,5.669c0,3.248,0,9.743,0,12.991c0,5.428,0,16.284,0,21.711
	c0,7.618,0,22.854,0,30.472c0,4.952,0,14.854,0,19.807C104.812,96.292,104.812,107.576,104.812,113.216z">
        <animate id="crema" attributeName="d" calcMode="spline"
                 keySplines="0 0 1 1; 0 0 1 1; 0 0 1 1; 0.25 0 1 1; 0 0 1 1; 0 0 0.58 1" begin="bizcocho_3.end"
                 dur="0.1s" fill="freeze" values="
                          M104.812,113.216c0,3.119-2.164,5.67-4.812,5.67c-2.646,0-4.812-2.551-4.812-5.67c0-5.594,0-16.782,0-22.375
	c0-5.143,0-15.427,0-20.568c0-7.333,0-21.998,0-29.33c0-5.523,0-16.569,0-22.092c0-3.295,0-9.885,0-13.181
	C95.188,2.551,97.353,0,100,0c2.648,0,4.812,2.551,4.812,5.669c0,3.248,0,9.743,0,12.991c0,5.428,0,16.284,0,21.711
	c0,7.618,0,22.854,0,30.472c0,4.952,0,14.854,0,19.807C104.812,96.292,104.812,107.576,104.812,113.216z
                          ;
                          M104.812,405.897c0,3.119-2.164,5.67-4.812,5.67c-2.646,0-4.812-2.551-4.812-5.67c0-5.594,0-16.782,0-22.376
	c0-5.143,0-15.426,0-20.568c0-7.332,0-21.997,0-29.33c0-5.522,0-16.568,0-22.092c0-3.295,0-9.885,0-13.181
	c0-3.118,2.165-5.669,4.812-5.669c2.648,0,4.812,2.551,4.812,5.669c0,3.247,0,9.743,0,12.991c0,5.428,0,16.283,0,21.711
	c0,7.618,0,22.854,0,30.473c0,4.951,0,14.854,0,19.807C104.812,388.972,104.812,400.256,104.812,405.897z
                          ;
                          M111.873,411.567c-3.119,0-9.226,0-11.874,0c-2.646,0-7.748,0-10.867,0c-7.086,0-12.698,0-18.292,0
	c-6.592,0-12.871,7.371-19.166,3.008c-10.043-6.961-7.776-10.169,2.991-17.745c12.61-8.873,27.713,1.994,25.919-7.531
	c-2.589-13.742,11.008-14.513,11.365-17.789c0.441-4.051,4.235-11.107,8.051-8.175c3.113,2.393,1.007,8.008,0,13.159
	c-1.871,9.569,8.058,2.113,9.494,14.155c2.592,21.732,21.184-0.675,29.309,7.976c5.216,5.553,18.413,5.552,15.426,12.942
	c-3.131,7.745-15.825-4.369-23.8,2.903C126.261,418.271,118.301,411.567,111.873,411.567z
                          ;
                          M111.873,411.567c-3.119,0-9.226,0-11.874,0c-2.646,0-9.734,4.069-12.853,4.069
	c-7.086,0-10.712-4.069-16.306-4.069c-6.592,0-12.12,6.013-19.166,3.008c-7.053-3.008-7.458,2.026-18.659,1.165
	c-6.832-0.525-7.522-3.034-7.533-6.265c-0.037-10.336,22.073-2.452,36.613-2.628c10.234-0.124,19.856-1.439,37.905-2.102
	c16.642-0.61,32.699,1.552,46.009,1.927c12.438,0.351,29.663-8.99,31.532,3.315c0.773,5.093-5.605,3.342-11.211,9.579
	c-5.093,5.667-7.59-4.605-12.965-3.832c-8.269,1.189-14.962-8.537-22.937-1.265C126.261,418.271,118.301,411.567,111.873,411.567z
                          ;
                          M110.946,413.652c-2.904-1.137-8.405-2.748-12.446-0.97c-6.099,2.685-7.273,10.358-13.253,8.242
	c-7.843-2.775-8.953-5.008-14.546-5.01c-24.653-0.011-4.849,26.507-18.264,26.507c-12.377,0,5.791-33.537-19.422-26.682
	c-7.703,2.095-9.806-0.942-9.817-4.173c-0.037-10.336,24.357-4.544,38.897-4.72c10.234-0.124,19.856-1.439,37.905-2.102
	c16.642-0.61,32.699,1.552,46.009,1.927c12.438,0.351,28.973-8.865,31.532,3.315c1.449,6.896,0.318,15.624-3.874,15.624
	c-7.619,0-1.788-15.192-19.243-7.111c-7.581,3.51-15.963-9.738-26.669,1.066C120.644,426.744,118.381,416.561,110.946,413.652z
                          ;
                          M111.547,413.9c-2.969-0.956-8.775-0.949-13.167-0.5c-14.667,1.5-8.325,16.508-14.667,16.666
	c-6.667,0.166-0.167-13.5-13.013-14.151c-30.471-1.545-5.572,46.651-18.987,46.651c-12.377,0,10.333-50.166-18.667-44.5
	c-7.835,1.531-9.537-1.417-9.548-4.647c-0.037-10.336,23.675-5.177,38.215-5.353c10.234-0.124,20.618-1.671,38.667-2.333
	c16.642-0.61,32.023,1.458,45.333,1.833c12.438,0.351,33.819-8.431,33.199,4.001c-0.532,10.666,0.414,26.166-5.245,25.833
	c-7.606-0.447-2.954-31.5-19.243-18.899c-7.985,6.177-17.658-5.969-27.377,5.732C118.88,434.066,121.38,417.067,111.547,413.9z
                          ;
                          M111.547,415.233c-6.667-0.834-9.667,4.667-13.833,3.333c-19.649-6.291-8.158,22.176-14.5,22.334
	c-6.667,0.166,2.833-18-13.333-22.167c-29.544-7.615-9.667,43.833-20.167,43.833c-10.333,0,8.004-55.006-16.833-39
	c-7.5,4.833-9.508-3.78-9.299-7.004c0.799-12.329,23.592-7.153,38.132-7.329c10.234-0.124,20.238-1.505,38.287-2.167
	c16.642-0.61,32.903,1.125,46.213,1.5c12.438,0.351,35.058-5.579,31.863,6.451c-5.532,20.833,1.25,28.216-4.409,27.883
	c-7.606-0.447-6.058-37.895-20.62-23.333c-10.167,10.166-15.972-0.747-25,12C119.547,443.568,121.798,416.515,111.547,415.233z
                          "/>
    </path>
                <rect x="10" y="475.571" fill="#fefae9" width="180" height="4"/>
</svg>

        </div>
        <div>
            <h1>happy birthday!</h1>
            <p>妹子~</p>
        </div>
    </div>

    <div id="wrapper">
        <input id="text" type="text" placeholder="送上祝福~~~(200字以内)"/>
        <span>
            <button class="sendbtn">发&nbsp;&nbsp;送</button>
            <button id="fullBtn" class="sendbtn">全&nbsp;&nbsp;屏</button>
        </span>
        <p style="color: red">总入场次数<span id="into_num">0</span>，前来祝贺的有<span id="peo_num">0</span>人，共送出了<span id="send_zfnum">0</span>份祝福！！！</p>
        <div class="zhujue">
            <span class="zhujuebtn">
                <button class="xvbtn" onclick="xvyuan()">许愿</button>
                <button class="chuibtn" onclick="chuilazhu()">吹蜡烛</button>
                <button class="fenbtn" onclick="fendangao()">分蛋糕</button>
            </span>
            <button class="sendzfbtn" id="sendzfff" onclick="send_zhufu()">送出祝福</button>
        </div>
    </div>
    <!-- 切好的蛋糕 -->
    <div id="dangao" style="display: inline-block">
        <img id="showDD" style="display: none" th:src="@{img/dd.png}">
    </div>
    <!-- 聊天信息 -->
    <div id="socketMessage"></div>
</div>
<!-- 背景音乐 -->
<audio id="myaudio1" th:src="@{music/3.mp3}" controls="controls" hidden="true">
</audio>
<audio id="myaudio2" th:src="@{music/2.mp3}" controls="controls" hidden="true">
</audio>
<!--<script th:src="@{js/jquery.js}"></script>-->
<!--<script th:src="@{js/index.js}" ></script>-->
<script th:src="@{js/common.js}"></script>
<script th:src="@{js/auto-play.js}"></script>

<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script>
<!--小帅哥： https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json-->
<!--萌娘：https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json-->
<!--小可爱（女）：https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json-->
<!--小可爱（男）：https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json-->
<!--初音：https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json-->
<!-- 上边的不同链接显示的是不同的小人，这个可以根据需要来选择 下边的初始化部分，可以修改宽高来修改小人的大小，或者是鼠标移动到小人上的透明度，也可以修改小人在页面出现的位置。 -->
<!-- 初音 -->
<script>
    // 萌娘
    // var chongwu = "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json";
    // 小可爱
    // var chongwu = "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json";
    // 初音
    var chongwu = "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json";
    L2Dwidget.init({
        "model": {
            jsonPath:
            chongwu,
            "scale": 1
        }, "display": {
            "position": "right", "width": 110, "height": 150,
            "hOffset": 0, "vOffset": -20
        }, "mobile": {"show": true, "scale": 0.5},
        "react": {"opacityDefault": 0.8, "opacityOnHover": 0.1}
    });
</script>
<script type="text/javascript">
    var username = null;
    $(function () {
        (function (doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    if(clientWidth>=750){
                        docEl.style.fontSize = '16px';
                    }else{
                        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                    }
                };
            recalc()
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
        
        username = '[[${session.username}]]';
        if (username.indexOf("冲") != -1) {
            /*$(".xvbtn").removeAttr("disabled");
            $(".chuibtn").removeAttr("disabled");
            $(".fenbtn").removeAttr("disabled");*/
            // $(".zhujue").show();
            $(".chuibtn").hide();
            $(".fenbtn").hide();
            $(".sendzfbtn").hide();
        } else {
            $(".xvbtn").attr({"disabled": "disabled"});
            $(".chuibtn").attr({"disabled": "disabled"});
            $(".fenbtn").attr({"disabled": "disabled"});
            $(".zhujuebtn").hide();
            $(".sendzfbtn").show();
        }
        
    })
    setInterval(getNums_ot,60000);
    function getNums_ot() {
        $.ajax({
            type : "get",
            url : "/interval/num",
            success : function (res) {
                $("#into_num").html(res.into_num);
                $("#peo_num").html(res.peo_num);
                $("#send_zfnum").html(res.send_zfnum);
            }
        })
    }
    
    var cmdml = null;

    // 许愿
    function xvyuan() {
        var msg = "现在开始许愿了哦~\n\n许愿完成之后要和大家说 我已经许愿了~";
        if (confirm(msg) == true) {
            websocket.send("cmd_xvyuan");
            cmdml = "cmd_xvyuan";
            $(".xvbtn").hide();
            $(".chuibtn").show();
            return true;
        } else {
            return false;
        }
    }

    // 分蛋糕
    function fendangao() {
        $(".fenbtn").hide();
        websocket.send("cmd_fendangao");
        cmdml = "cmd_fendangao";
    }

    // 播放背景音乐
    function playTest(i, audicls) {
        var aa = $(audicls);
        if (i > aa.length) {
            i = 1;
        }
        var tt = document.getElementById("myaudio" + i);
        tt.play();
        tt.addEventListener('ended', function () {
            i++;
            playTest(i, audicls);
        }, false);
    }

    playTest(1, "audio");

    // 吹蜡烛
    function chuilazhu() {
        websocket.send("cmd_chuilazhu");
        $(".chuibtn").hide();
        $(".fenbtn").show();
    }
    // 送祝福
    function send_zhufu() {
        displayTime();
        websocket.send("cmd_zhufu_" + username);
        getNums_ot();
    }
    function displayTime() {
        $("#sendzfff").text(5);
        $("#sendzfff").attr({"disabled": "disabled"});
        setTimeout("tick()",1000);
    }
    function tick() {
        let zfnum = $("#sendzfff").text();
        console.log("祝福按钮文字" + zfnum);
        var time = new Number(zfnum);
        if(time > 0) {
            $("#sendzfff").text(time - 1);
            setTimeout("tick()",1000);
        } else {
            $("#sendzfff").removeAttr("disabled");
            $("#sendzfff").text("送出祝福");
        }
    }

    var serverUrl = "://129.211.113.87:";
    // var serverUrl = "://localhost:";
    var websocket = null;
    //判断当前浏览器是否支持WebSocket, 主要此处要更换为自己的地址
    if ('WebSocket' in window) {
        // websocket = new WebSocket("ws" + serverUrl + "11203/birthday/server");
        websocket = new WebSocket("ws://localhost:11203/birthday/server");
        // websocket = new WebSocket("ws://192.168.0.102:11203/birthday/server");
    } else {
        alert('Not support websocket')
    }
    //连接发生错误的回调方法
    websocket.onerror = function (event) {
        // setMessageInnerHTML(event.data);
        setMessageInnerHTML("服务器错误");
    };
    //连接成功建立的回调方法
    websocket.onopen = function (event) {
        websocket.send("cmd_welcome_" + username);
        document.getElementsByClassName("bodyful");
        setMessageInnerHTML("正在准备蛋糕...");
        getNums_ot();
        //setMessageInnerHTML("open");
    }
    //接收到消息的回调方法
    websocket.onmessage = function (event) {
        var mls = event.data;
        /*if (mls.indexOf("cmd_getCount") != -1) {
            peoCount = mls.split("cmd_getCount_")[1];
        } else {
            
        }*/
        var showMSG = "";
        if (mls == "cmd_chuilazhu") {
            showMSG = "fu~~~蜡烛灭了，接下来就开始分蛋糕了哦~";
            $(".fuego").hide();
            setTimeout(function () {
                $(".velas").hide();
            }, 1000);
        } else if (mls == "cmd_fendangao") {
            showMSG = "开始分蛋糕了~~~";
            var cakes = $("#cake path");
            var i = 0;
            var caks = cakes.length;
            setInterval(function () {
                if (i >= caks) {
                    $("#showDD").show();
                    return false;
                }
                cakes.eq(caks - 1).hide();
                cakes.eq(i).hide();
                i++;
            }, 500);
        } else {
            showMSG = mls;
        }
        setMessageInnerHTML(showMSG);
        danmuPool.push(showMSG);
    }
    //连接关闭的回调方法
    websocket.onclose = function () {
        // setMessageInnerHTML("close");
    }
    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
    window.onbeforeunload = function () {
        websocket.close();
    }

    //将消息显示在网页上
    function setMessageInnerHTML(innerHTML) {
        document.getElementById('socketMessage').innerHTML += innerHTML + '<br/><br/>';
    }

    //关闭连接
    function closeWebSocket() {
        websocket.close();
    }

    /**
     * 设置 弹幕DOM池 每一个通道最多六条弹幕
     **/
    const MAX_DM_COUNT = 3;
    const CHANNEL_COUNT = 10;
    let domPool = [];
    let danmuPool = [];
    let hasPosition = [];

    /**
     * 做一下初始化工作
     */
    function init() {
        let wrapper = document.getElementById('wrapper')
        // 先new一些span 重复利用这些DOM
        console
        for (let j = 0; j < CHANNEL_COUNT; j++) {
            let doms = [];
            for (let i = 0; i < MAX_DM_COUNT; i++) {
                // 要全部放进wrapper
                let dom = document.createElement('span');
                wrapper.appendChild(dom);
                // 初始化dom的位置 通过设置className
                dom.className = 'right';
                dom.style.color = "black";
                dom.style.fontWeight = "normal";
                // DOM的通道是固定的 所以设置好top就不需要再改变了
                dom.style.top = j * 10 + 'px';
                debugger;
                // 放入改通道的DOM池
                doms.push(dom);
                // 每次到transition结束的时候 就是弹幕划出屏幕了 将DOM位置重置 再放回DOM池
                dom.addEventListener('transitionend', function () {
                    dom.className = 'right';
                    dom.style.transform = null;
                    domPool[j].push(dom);
                });
            }
            domPool.push(doms);
        }
        // hasPosition 标记每个通道目前是否有位置
        for (let i = 0; i < CHANNEL_COUNT; i++) {
            hasPosition[i] = true;
        }
    }

    /**
     * 获取一个可以发射弹幕的通道 没有则返回-1
     */
    function getChannel() {
        for (let i = 0; i < CHANNEL_COUNT; i++) {
            if (hasPosition[i] && domPool[i].length) return i;
        }
        return -1;
    }

    /**
     * 根据DOM和弹幕信息 发射弹幕
     */
    function shootDanmu(dom, text, channel) {
        dom.innerText = text;
        // 如果为每个弹幕设置 transition 可以保证每个弹幕的速度相同 这里没有保证速度相同
        dom.style.transition = 'transform ${15 + dom.clientWidth / 100}s linear';
        dom.style.fontSize = "16px";
        dom.style.left = '-' + dom.clientWidth + 'px';
        // 设置弹幕的位置信息 性能优化 left -> transform
        dom.style.transform = 'translateX(${-dom.clientWidth}px)';
        // dom.style.transform = 'translateX(-200px)';
        dom.className = 'left';
        hasPosition[channel] = true;
        // 弹幕全部显示之后 才能开始下一条弹幕
        // 大概 dom.clientWidth * 10 的时间 该条弹幕就从右边全部划出到可见区域 再加1秒保证弹幕之间距离
        hasPosition[channel] = true;
        setTimeout(() => {
            hasPosition[channel] = true;
        }, dom.clientWidth * 1 + 1000);
    }

    $(".sendbtn").eq(0).click(function () {
        send();
    })
    $("#fullBtn").click(function () {
        requestFullScreen();
    })
    $("#text").keydown(function (event) {
        var code = event.keyCode;
        if (code == 13) {
            send();
        }
    })

    function send() {
        let message = $("#text").val().trim();
        let mLen = message.length;
        if (mLen > 0) {
            if (mLen > 200) {
                message = message.substring(0, 200);
            }
            websocket.send(message);
            $("#text").val("");
        }
        // $("#socketMessage").scrollTop($("#socketMessage").height());
        $('#socketMessage').animate({
            scrollTop: $('#socketMessage').get(0).scrollHeight
        }, 100);
    }

    init();
    // 每隔1ms从弹幕池里获取弹幕（如果有的话）并发射
    setInterval(function () {
        let channel;
        if (danmuPool.length > 0 && (channel = getChannel()) != -1) {
            let dom = domPool[channel].shift();
            let danmu = danmuPool.shift();
            shootDanmu(dom, danmu, channel);
        }
    }, 1000);

</script>
<!-- 小可爱 -->
<div id="spig" class="spig">
    <div id="message">……</div>
    <div id="mumu" class="mumu" th:style="'background-image:url(/img/chong.gif)'"></div>
</div>
</body>
<script type="text/javascript">
    var visitor = "仙女小姐姐";
    //根据分辨率调整小人位置
    var addHeight;
    if (window.screen.height == '1080') {
        addHeight = 350;
    } else {
        addHeight = 150;
    }

    //鼠标在上方时
    var quanMsg = [];
    jQuery(document).ready(function ($) {
        //$(".mumu").jrumble({rangeX: 2,rangeY: 2,rangeRot: 1});
        $(".mumu").mouseover(function () {
            $(".mumu").fadeTo("300", 0.3);
            quanMsg = ["我隐身了，你看不到我", "我会隐身哦！嘿嘿！", "别动手动脚的，把手拿开！", "把手拿开我才出来！"];
            var i = Math.floor(Math.random() * quanMsg.length);
            showMessage(quanMsg[i]);
        });
        $(".mumu").mouseout(function () {
            $(".mumu").fadeTo("300", 1)
        });
    });

    //开始
    jQuery(document).ready(function ($) {
        var now = (new Date()).getHours();
        console.log("时间：" + now)
        if (now > 0 && now <= 6) {
            showMessage(visitor + ' 你是夜猫子呀？还不睡觉，明天起的来么你？', 6000);
        } else if (now > 6 && now <= 11) {
            showMessage(visitor + ' 早上好，早起的鸟儿有虫吃噢！早起的虫儿被鸟吃，你是鸟儿还是虫儿？嘻嘻！', 6000);
        } else if (now > 11 && now <= 14) {
            showMessage(visitor + ' 中午了，吃饭了么？不要饿着了，饿死了谁来挺我呀！', 6000);
        } else if (now > 14 && now <= 18) {
            showMessage(visitor + ' 中午的时光真难熬！还好有你在！晚饭也好香啊~', 6000);
        } else {
            showMessage(visitor + ' 快来逗我玩吧！', 6000);
        }
        $(".spig").animate({
            top: $(".spig").offset().top + addHeight,
            left: 100
        }, {
            queue: false,
            duration: 1000
        });
    });

    var peoCount = 0;

    function getPeopleCount() {
        websocket.send("cmd_getCount");
    }

    //无聊讲点什么
    jQuery(document).ready(function ($) {
        /*window.setInterval(function () {
            getPeopleCount();
        }, 100);*/
        window.setInterval(function () {
            var wumsgs = ["陪我聊天吧！", "好无聊哦，你都不陪我玩！", "对面的女孩看过来，看过来。。。", "哇，漂亮的仙女姐姐~~~", "我可爱吧！嘻嘻!~^_^!~~", "从前有座山，山上有座庙，庙里有个老和尚给小和尚讲故事，讲：“从前有座……”",
                "此女只应天上有，人间难得几回遇。", "今晚的星星和月亮都像你遥不可及地好看。", "就像画里的人，霎时间就飘了下来。", "你那瓜子形的形，那么白净，弯弯的一双眉毛，那么修长；水汪汪的一对眼睛，那么明亮！",
                "我觉得世界上所有的褒义词都适合你。", "你不化妆是天生丽质，化了妆是仙女下凡。", "你能笑一下吗，我的咖啡忘记加糖了。", "你笑的时候我心里像被撒了一把跳跳糖。", "真是人间水蜜桃了呢~ 你就是人间的风花雪月。",
                "今晚的星星和月亮都像你 遥不可及地好看。", "一颦一笑，一举一动，扣人心弦。", "比今天的你更好看的只有明天的你！", "说吧，你为什么要下凡", "世界上最好看的人在我眼睛里，不信你看！",
                "我从来都不骗人，如果我骗你了，那也骗的是仙女", "不要以为你长得漂亮，身材好，大眼睛，双眼皮，说话声音好听，走路样子好看就可以随便欺负我。", "西湖美不美，美；东湖美不美 ，美！不过，有你在我面前，足以使我陶醉。",
                "喜欢我的扣1 不喜欢我的八千字说明理由", "认识你之后，一种智力上的优越感，油然而生。", "好多小姐姐呐~快来和我玩呀~~~", "是你们让我正能量满满呀！！！",
                "在很久很久以前，有一个漂亮可爱美丽的公主， 她被一个邪恶的巫婆诅咒了，沉沉地睡了过去。 后来，一位王子亲了她一口，于是她就醒了。 这个故事告诉我们没有充足的睡眠是无法成为公主的。 那么，我的公主， 可以睡了吗？",
                "我觉得世界上就只有两种人能吸引人，一种是有智慧的，一种是漂亮的，而你是聪明并且又好看的。", "你像天上的月亮，也像那闪烁的星星，可惜我不是诗人，否则，当写一万首诗来形容你的美丽。",
                "你头脑精灵，作事不托泥戴水，知道随机应变，懂团结，爱帮助同事，做事有条有理。", "尽管你身材纤弱娇小，说话柔声细气，然而却很有力量，这是一种真正的精神美！", "哥哥美得像朵花，我弹起心爱的土琵琶。",
                "你是吃可爱长大的吧！", "可盐可甜，一眼万年~", "还不多吃点，你看看你都瘦成啥样了？", "哇，我是如此幸运，遇到你们，认识你们。",
                "生活很讨厌，还好你够可爱。", "你这么可爱，反抗是不敢反抗的，就偷偷略略略这样子", "无语，最烦你天天和我抱怨说想去迪士尼 想见公主。你就不能自己照照镜子？", "天哪，仙女仙男们扎堆进来了！！！好嗨呦"];
            var i = Math.floor(Math.random() * wumsgs.length);
            danmuPool.push(wumsgs[i]);
            showMessage(wumsgs[i], 8000);
        }, 15000);
    });

    //滚动条移动
    /*jQuery(document).ready(function ($) {
        var f = $(".spig").offset().top;
        $(window).scroll(function () {
            $(".spig").animate({
                top: $(window).scrollTop() + f +addHeight
            },{
                queue: false,
                duration: 1000
            });
        });
    });*/

    //鼠标点击时
    jQuery(document).ready(function ($) {
        var stat_click = 0;
        $(".mumu").click(function () {
            stat_click++;
            if (stat_click > 4) {
                quanMsg = ["你有完没完呀？", "不要以为你长得漂亮，身材好，大眼睛，双眼皮，说话声音好听，走路样子好看就可以随便欺负我。", "你已经摸我" + stat_click + "次了", "非礼呀！救命！OH，My ladygaga"];
            } else {
                quanMsg = ["筋斗云！~我飞！", "我跑呀跑呀跑！~~", "别摸我，有什么好摸的！", "惹不起你，我还躲不起你么？", "不要摸我了，我会告诉主人来打你的！", "干嘛动我呀！小心我咬你！"];
            }
            var s = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.75, -0.1, -0.2, -0.3, -0.4, -0.5, -0.6, -0.7, -0.75];
            var i1 = Math.floor(Math.random() * s.length);
            var i2 = Math.floor(Math.random() * quanMsg.length);
            $(".spig").animate({
                left: document.body.offsetWidth / 2 * (1 + s[i1]),
                top: document.body.offsetHeight / 2 * (1 + s[i1])
            }, {
                duration: 500,
                complete: showMessage(quanMsg[i2])
            });
        });
    });

    //显示消息函数
    function showMessage(a, b) {
        if (b == null) b = 1000;
        jQuery("#message").hide().stop();
        jQuery("#message").html(a);
        jQuery("#message").fadeIn();
        jQuery("#message").fadeTo("1", 1);
        jQuery("#message").fadeOut(b);
    };

    //拖动
    var _move = false;
    var ismove = false; //移动标记
    var _x, _y; //鼠标离控件左上角的相对位置
    jQuery(document).ready(function ($) {
        $("#spig").mousedown(function (e) {
            _move = true;
            _x = e.pageX - parseInt($("#spig").css("left"));
            _y = e.pageY - parseInt($("#spig").css("top"));
        });
        $(document).mousemove(function (e) {
            if (_move) {
                var x = e.pageX - _x;
                var y = e.pageY - _y;
                var wx = $(window).width() - $('#spig').width();
                var dy = $(document).height() - $('#spig').height();
                if (x >= 0 && x <= wx && y > 0 && y <= dy) {
                    $("#spig").css({
                        top: y,
                        left: x
                    }); //控件新位置
                    ismove = true;
                }
            }
        }).mouseup(function () {
            _move = false;
        });
    });
</script>
<!-- 移动端移动事件 -->
<script type="text/javascript">
    $(function () {
        var cont = $("#spig");
        var contW = $("#spig").width();
        var contH = $("#spig").height();
        var startX, startY, sX, sY, moveX, moveY;
        var winW = $(window).width();
        var winH = $(window).height();

        cont.on({//绑定事件
            touchstart: function (e) {
                startX = e.originalEvent.targetTouches[0].pageX;    //获取点击点的X坐标    
                startY = e.originalEvent.targetTouches[0].pageY;    //获取点击点的Y坐标
                //console.log("startX="+startX+"************startY="+startY);
                sX = $(this).offset().left;//相对于当前窗口X轴的偏移量
                sY = $(this).offset().top;//相对于当前窗口Y轴的偏移量
                //console.log("sX="+sX+"***************sY="+sY);
                leftX = startX - sX;//鼠标所能移动的最左端是当前鼠标距div左边距的位置
                rightX = winW - contW + leftX;//鼠标所能移动的最右端是当前窗口距离减去鼠标距div最右端位置
                topY = startY - sY;//鼠标所能移动最上端是当前鼠标距div上边距的位置
                bottomY = winH - contH + topY;//鼠标所能移动最下端是当前窗口距离减去鼠标距div最下端位置                
            },
            touchmove: function (e) {
                e.preventDefault();
                moveX = e.originalEvent.targetTouches[0].pageX;//移动过程中X轴的坐标
                moveY = e.originalEvent.targetTouches[0].pageY;//移动过程中Y轴的坐标
                //console.log("moveX="+moveX+"************moveY="+moveY);
                if (moveX < leftX) {
                    moveX = leftX;
                }
                if (moveX > rightX) {
                    moveX = rightX;
                }
                if (moveY < topY) {
                    moveY = topY;
                }
                if (moveY > bottomY) {
                    moveY = bottomY;
                }
                $(this).css({
                    "left": moveX + sX - startX,
                    "top": moveY + sY - startY,
                })
            },

        })

    })
</script>
<!-- sakura shader -->
<script id="sakura_point_vsh" type="x-shader/x_vertex">
uniform mat4 uProjection;
uniform mat4 uModelview;
uniform vec3 uResolution;
uniform vec3 uOffset;
uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start

attribute vec3 aPosition;
attribute vec3 aEuler;
attribute vec2 aMisc; //x:size, y:fade

varying vec3 pposition;
varying float psize;
varying float palpha;
varying float pdist;

//varying mat3 rotMat;
varying vec3 normX;
varying vec3 normY;
varying vec3 normZ;
varying vec3 normal;

varying float diffuse;
varying float specular;
varying float rstop;
varying float distancefade;

void main(void) {
    // Projection is based on vertical angle
    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);
    gl_Position = uProjection * pos;
    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;
    
    pposition = pos.xyz;
    psize = aMisc.x;
    pdist = length(pos.xyz);
    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);
    
    vec3 elrsn = sin(aEuler);
    vec3 elrcs = cos(aEuler);
    mat3 rotx = mat3(
        1.0, 0.0, 0.0,
        0.0, elrcs.x, elrsn.x,
        0.0, -elrsn.x, elrcs.x
    );
    mat3 roty = mat3(
        elrcs.y, 0.0, -elrsn.y,
        0.0, 1.0, 0.0,
        elrsn.y, 0.0, elrcs.y
    );
    mat3 rotz = mat3(
        elrcs.z, elrsn.z, 0.0, 
        -elrsn.z, elrcs.z, 0.0,
        0.0, 0.0, 1.0
    );
    mat3 rotmat = rotx * roty * rotz;
    normal = rotmat[2];
    
    mat3 trrotm = mat3(
        rotmat[0][0], rotmat[1][0], rotmat[2][0],
        rotmat[0][1], rotmat[1][1], rotmat[2][1],
        rotmat[0][2], rotmat[1][2], rotmat[2][2]
    );
    normX = trrotm[0];
    normY = trrotm[1];
    normZ = trrotm[2];
    
    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);
    
    float tmpdfs = dot(lit, normal);
    if(tmpdfs < 0.0) {
        normal = -normal;
        tmpdfs = dot(lit, normal);
    }
    diffuse = 0.4 + tmpdfs;
    
    vec3 eyev = normalize(-pos.xyz);
    if(dot(eyev, normal) > 0.0) {
        vec3 hv = normalize(eyev + lit);
        specular = pow(max(dot(hv, normal), 0.0), 20.0);
    }
    else {
        specular = 0.0;
    }
    
    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);
    rstop = pow(rstop, 0.5);
    //-0.69315 = ln(0.5)
    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));
}

</script>
<script id="sakura_point_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif

uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start

const vec3 fadeCol = vec3(0.08, 0.03, 0.06);

varying vec3 pposition;
varying float psize;
varying float palpha;
varying float pdist;

//varying mat3 rotMat;
varying vec3 normX;
varying vec3 normY;
varying vec3 normZ;
varying vec3 normal;

varying float diffuse;
varying float specular;
varying float rstop;
varying float distancefade;

float ellipse(vec2 p, vec2 o, vec2 r) {
    vec2 lp = (p - o) / r;
    return length(lp) - 1.0;
}

void main(void) {
    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;
    vec3 d = vec3(0.0, 0.0, -1.0);
    float nd = normZ.z; //dot(-normZ, d);
    if(abs(nd) < 0.0001) discard;
    
    float np = dot(normZ, p);
    vec3 tp = p + d * np / nd;
    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));
    
    //angle = 15 degree
    const float flwrsn = 0.258819045102521;
    const float flwrcs = 0.965925826289068;
    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);
    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;
    
    float r;
    if(flwrp.x < 0.0) {
        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);
    }
    else {
        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);
    }
    
    if(r > rstop) discard;
    
    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);
    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));
    col *= vec3(1.0, grady, grady);
    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));
    col = col * diffuse + specular;
    
    col = mix(fadeCol, col, distancefade);
    
    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;
    alpha = smoothstep(0.0, 1.0, alpha) * palpha;
    
    gl_FragColor = vec4(col * 0.5, alpha);
}

</script>
<!-- effects -->
<script id="fx_common_vsh" type="x-shader/x_vertex">
uniform vec3 uResolution;
attribute vec2 aPosition;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
}

</script>
<script id="bg_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif

uniform vec2 uTimes;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    vec3 col;
    float c;
    vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);
    c = exp(-pow(length(tmpv) * 1.8, 2.0));
    col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);
    gl_FragColor = vec4(col * 0.5, 1.0);
}

</script>
<script id="fx_brightbuf_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    vec4 col = texture2D(uSrc, texCoord);
    gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);
}

</script>
<script id="fx_dirblur_r4_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;
uniform vec4 uBlurDir; //dir(x, y), stride(z, w)

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    vec4 col = texture2D(uSrc, texCoord);
    col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);
    col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);
    col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);
    col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);
    gl_FragColor = col / 5.0;
}

</script>
<!-- effect fragment shader template -->
<script id="fx_common_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    gl_FragColor = texture2D(uSrc, texCoord);
}

</script>
<!-- post processing -->
<script id="pp_final_vsh" type="x-shader/x_vertex">
uniform vec3 uResolution;
attribute vec2 aPosition;
varying vec2 texCoord;
varying vec2 screenCoord;
void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
}

</script>
<script id="pp_final_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
//precision mediump float;
precision highp float;
#endif
uniform sampler2D uSrc;
uniform sampler2D uBloom;
uniform vec2 uDelta;
varying vec2 texCoord;
varying vec2 screenCoord;
void main(void) {
    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;
    vec4 bloomcol = texture2D(uBloom, texCoord);
    vec4 col;
    col = srccol + bloomcol * (vec4(1.0) + srccol);
    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);
    col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)
    
    gl_FragColor = vec4(col.rgb, 1.0);
    gl_FragColor.a = 1.0;
}

</script>
<!-- partial -->
<script th:src="@{js/sakura_script.js}"></script>
</html>